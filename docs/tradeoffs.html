<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 8 Quantifying life history traits | Bayesian analysis of capture-recapture data with hidden Markov models</title>
<meta name="author" content="Olivier Gimenez">
<meta name="description" content="8.1 Introduction Capture-recapture models allow the estimation of key demographic parameters such as survival, recruitment, and dispersal. These parameters are central to life history theory,...">
<meta name="generator" content="bookdown 0.43 with bs4_book()">
<meta property="og:title" content="Chapter 8 Quantifying life history traits | Bayesian analysis of capture-recapture data with hidden Markov models">
<meta property="og:type" content="book">
<meta property="og:url" content="https://oliviergimenez.github.io/banana-book/tradeoffs.html">
<meta property="og:description" content="8.1 Introduction Capture-recapture models allow the estimation of key demographic parameters such as survival, recruitment, and dispersal. These parameters are central to life history theory,...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 8 Quantifying life history traits | Bayesian analysis of capture-recapture data with hidden Markov models">
<meta name="twitter:description" content="8.1 Introduction Capture-recapture models allow the estimation of key demographic parameters such as survival, recruitment, and dispersal. These parameters are central to life history theory,...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Theory and case studies in R and NIMBLE">Bayesian analysis of capture-recapture data with hidden Markov models</a>:
        <small class="text-muted">Theory and case studies in R and NIMBLE</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li class="book-part">Foundations</li>
<li><a class="" href="introduction.html">Introduction</a></li>
<li><a class="" href="crashcourse.html"><span class="header-section-number">1</span> Bayesian statistics &amp; MCMC</a></li>
<li><a class="" href="intronimble.html"><span class="header-section-number">2</span> NIMBLE tutorial</a></li>
<li><a class="" href="hmmcapturerecapture.html"><span class="header-section-number">3</span> Hidden Markov models</a></li>
<li class="book-part">Transitions</li>
<li><a class="" href="introduction-4.html">Introduction</a></li>
<li><a class="" href="survival.html"><span class="header-section-number">4</span> Alive and dead</a></li>
<li><a class="" href="dispersal.html"><span class="header-section-number">5</span> Sites and states</a></li>
<li class="book-part">Case studies</li>
<li><a class="" href="introduction-7.html">Introduction</a></li>
<li><a class="" href="covariateschapter.html"><span class="header-section-number">6</span> Dealing with covariates</a></li>
<li><a class="" href="lackoffit.html"><span class="header-section-number">7</span> Addressing model lack of fit</a></li>
<li><a class="active" href="tradeoffs.html"><span class="header-section-number">8</span> Quantifying life history traits</a></li>
<li><a class="" href="conclusion.html">Conclusion</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/oliviergimenez/banana-book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tradeoffs" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Quantifying life history traits<a class="anchor" aria-label="anchor" href="#tradeoffs"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-10" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-10"><i class="fas fa-link"></i></a>
</h2>
<p>Capture-recapture models allow the estimation of key demographic parameters such as survival, recruitment, and dispersal. These parameters are central to life history theory, which seeks to explain how organisms allocate limited resources across survival, growth, and reproduction over their lifetime. Life-history traits, such as age at first breeding, breeding frequency, or lifespan, reflect trade-offs shaped by natural selection and environmental constraints.</p>
<p>Capture-recapture data are particularly suited to quantifying such traits in the wild, providing direct estimates that can be compared to theoretical predictions. As introduced in Section <a href="dispersal.html#states">5.5</a>, states and transitions between them – whether disease, developmental, or breeding states – can be incorporated naturally into the HMM framework.</p>
<p>In this chapter, we focus on three examples: cause- and age-specific mortalities, age-specific breeding probabilities, and stopover duration. Together, they illustrate how capture-recapture HMMs can shed light on life-history strategies.</p>
</div>
<div id="assessing-age--and-cause-specific-mortality" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Assessing age- and cause-specific mortality<a class="anchor" aria-label="anchor" href="#assessing-age--and-cause-specific-mortality"><i class="fas fa-link"></i></a>
</h2>
<div id="motivation-6" class="section level3" number="8.2.1">
<h3>
<span class="header-section-number">8.2.1</span> Motivation<a class="anchor" aria-label="anchor" href="#motivation-6"><i class="fas fa-link"></i></a>
</h3>
<p>Cause‐ and age-specific mortalities are key life-history traits, shaping population dynamics and informing management or conservation strategies. Yet in the wild, direct assignment of causes of death is challenging as field observations are often incomplete, and carcass recovery is biased towards certain causes of death or habitats. If we ignore this uncertainty, estimates of mortality rates by cause or age class can be biased, and our understanding of population processes compromised.</p>
<p>The fix is to treat cause of death as a latent state. Following <span class="citation">Koons et al. (<a href="references.html#ref-koons2014">2014</a>)</span>, we model survival and transitions to cause-specific death states jointly within a HMM capture-recapture framework. To do so, we combine data on recaptures of live and recoveries of dead animals. Individuals can either survive to the next occasion or die from one of several competing causes, with probabilities that may depend on age.</p>
<p>Here, we use the case study on roe deer (<em>Capreolus capreolus</em>) in <span class="citation">Koons et al. (<a href="references.html#ref-koons2014">2014</a>)</span>. The authors show that failing to account for uncertain cause assignment underestimated mortality from hunting and overestimated natural mortality, particularly in younger age classes.</p>
<p>Here, we define cause‐specific death states, let survival and cause‐specific mortality depend on age, and keep the rest of the HMM machinery unchanged in NIMBLE.</p>
</div>
<div id="model-and-nimble-implementation-6" class="section level3" number="8.2.2">
<h3>
<span class="header-section-number">8.2.2</span> Model and NIMBLE implementation<a class="anchor" aria-label="anchor" href="#model-and-nimble-implementation-6"><i class="fas fa-link"></i></a>
</h3>
<p>For our example, we will use data on roe deer from a population in the enclosed forest of the Territoire d’Etude et d’Expérimentation of Trois Fontaines, in eastern France. Here, we focus on 556 known-age females (marked as fawns), of which 217 were recaptured at least once and 41 were deadly injured during handling, victim of car collisions, or recovered and reported by hunters (human-related mortalities). These data were kindly provided by Marlène Gamelon.</p>
<p>To build up our model, we first define the states and observations:</p>
<ul>
<li><p>States<br>
- A for alive<br>
- H for an individual that just died from human causes<br>
- NH for an individual that just died from a natural (non-human) cause<br>
- D for an individual that is already dead</p></li>
<li><p>Observations<br>
- 1 for not seen<br>
- 2 for captured for the first time or recaptured<br>
- 3 for killed by human activities and reported</p></li>
</ul>
<p>Now we turn to writing our model. We start with the vector of initial states. Individuals enter alive the study with probability 1:
<span class="math display">\[\begin{matrix}
&amp; \\
\mathbf{\delta} =
\left ( \vphantom{ \begin{matrix} 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
z_t=A &amp; z_t=H &amp; z_t=NH &amp; z_t=D \\ \hdashline
1 &amp; 0 &amp; 0 &amp; 0\\
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \end{matrix} } \right )
\begin{matrix}
\end{matrix}
\end{matrix}\]</span></p>
<p>We proceed with the transition matrix:
<span class="math display">\[\begin{matrix}
&amp; \\
\mathbf{\Gamma} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
z_t=A &amp; z_t=H &amp; z_t=NH &amp; z_t=D \\ \hdashline
1 - \mu_H - \mu_{NH}  &amp; \mu_H &amp; \mu_{NH} &amp; 0\\
0 &amp; 0 &amp; 0 &amp;  1\\
0 &amp; 0 &amp; 0 &amp;  1\\
0 &amp; 0 &amp; 0 &amp;  1
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
z_{t-1}=A \\ z_{t-1}=H \\ z_{t-1}=NH \\ z_{t-1}=D
\end{matrix}
\end{matrix}\]</span></p>
<p>where the transition probability from <span class="math inline">\(A\)</span> at <span class="math inline">\(t\)</span> to <span class="math inline">\(H\)</span> at <span class="math inline">\(t + 1\)</span> is the human-related mortality probability <span class="math inline">\(\mu_H\)</span> and the transition probability from <span class="math inline">\(A\)</span> at <span class="math inline">\(t\)</span> to <span class="math inline">\(NH\)</span> at <span class="math inline">\(t + 1\)</span> is the natural mortality probability <span class="math inline">\(\mu_{NH}\)</span>. Because an individual could not return to state <span class="math inline">\(A\)</span> once dead, we fix these transitions to 0.</p>
<p>Following the paper, adult survival is age-specific: <span class="math inline">\(\mu_H\)</span> is different for individuals in their first year of life after birth ([0,1[) vs. age 1 onwards, while <span class="math inline">\(\mu_{NH}\)</span> has two different parameters for ages [0,1[ and [1,2[ then a linear trend with age from age 2 onward. We use a multinomial logit link function to ensure that mortality probabilities are estimated between 0 and 1 and sum up to 1, see Section <a href="dispersal.html#multinomiallogit">5.4.2</a>. In NIMBLE, we code:</p>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transition matrix</span></span>
<span><span class="co"># Age effects</span></span>
<span><span class="va">etaH</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">alpha_H_01</span> <span class="op">*</span> <span class="va">age_lt1</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span> <span class="op">+</span> <span class="va">alpha_H_ge1</span> <span class="op">*</span> <span class="va">age_ge1</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">etaNH</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">alpha_NH_01</span> <span class="op">*</span> <span class="va">age_lt1</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span> <span class="op">+</span>                               <span class="co"># if age is [0,1[</span></span>
<span>                 <span class="va">alpha_NH_12</span> <span class="op">*</span> <span class="va">age_1to2</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span> <span class="op">+</span>                            <span class="co"># if age is [1,2[</span></span>
<span>                 <span class="op">(</span><span class="va">beta0_NH</span> <span class="op">+</span> <span class="va">beta1_NH</span> <span class="op">*</span> <span class="va">age_std_mu2</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">age_ge2</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="co"># linear trend if age &gt;= 2</span></span>
<span></span>
<span><span class="co"># Transitions from A</span></span>
<span><span class="va">den</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">etaH</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">etaNH</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span><span class="op">)</span>  <span class="co"># denominator</span></span>
<span><span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">den</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span>                    <span class="co"># stay alive</span></span>
<span><span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">etaH</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">den</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span>       <span class="co"># muH</span></span>
<span><span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">1</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">etaNH</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">den</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span>      <span class="co"># muNH</span></span>
<span><span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>                               <span class="co"># always 0</span></span>
<span></span>
<span><span class="co"># From H, NH, D (always go to D)</span></span>
<span><span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">3</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">4</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">gamma</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span>,<span class="fl">4</span>,<span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
<p>In the code above, age is passed in the data and created as follows:</p>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build an N x K age matrix</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">obs_matrix</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">K</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">obs_matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="va">first</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">:</span><span class="va">K</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">age</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">t</span> <span class="op">-</span> <span class="va">first</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>   <span class="co"># age 0 at first capture</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Define age [0,1[ and age &gt;=1</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">obs_matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="va">first</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">:</span><span class="va">K</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">age_val</span> <span class="op">&lt;-</span> <span class="va">age</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">age_val</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span> <span class="co"># age &lt; 1</span></span>
<span>      <span class="va">age_lt1</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">age_ge1</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>            <span class="co"># age &gt;= 1</span></span>
<span>      <span class="va">age_lt1</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span>  </span>
<span>      <span class="va">age_ge1</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># Define age &gt;1 and age [1,2[</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">obs_matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="va">first</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">:</span><span class="va">K</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">age_val</span> <span class="op">&lt;-</span> <span class="va">age</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">]</span></span>
<span>    <span class="va">age_ge2</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">age_val</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>   <span class="co"># age &gt; 1 or 2 onwards</span></span>
<span>    <span class="va">age_1to2</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">age_val</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># age in [1,2[</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Last step is the observation matrix:
<span class="math display">\[\begin{matrix}
&amp; \\
\mathbf{\Omega} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
y_t=1 &amp; y_t=2 &amp; y_t=3\\ \hdashline
1 - p &amp; p &amp; 0 \\
1 - \lambda &amp; 0 &amp; \lambda\\
1 &amp; 0 &amp; 0\\
1 &amp; 0 &amp; 0
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
z_{t}=A \\ z_{t}=H \\ z_{t}=NH \\ z_{t}=D
\end{matrix}
\end{matrix}\]</span></p>
<p>where a live individual can be detected with probability <span class="math inline">\(p\)</span>, or not with probability <span class="math inline">\(1−p\)</span>. We include time-dependence and age on <span class="math inline">\(p\)</span>, with a different parameter for 1 year-old individuals vs. individuals older than 1 year of age. In NIMBLE, we write:</p>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pA</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p_ageLE1</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">*</span> <span class="va">age_lt1</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span> <span class="op">+</span> <span class="va">p_ageGT1</span><span class="op">[</span><span class="va">t</span><span class="op">]</span> <span class="op">*</span> <span class="va">age_ge1</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">]</span></span></code></pre></div>
<p>An individual that just died from human causes can be recovered and reported with probability <span class="math inline">\(\lambda\)</span>, or not with probability <span class="math inline">\(1-\lambda\)</span>. Because tag recovery protocols were constant over the course of the study, the authors considered that parameter to be constant over time and across age classes.</p>
</div>
<div id="results-and-interpretation-6" class="section level3" number="8.2.3">
<h3>
<span class="header-section-number">8.2.3</span> Results and interpretation<a class="anchor" aria-label="anchor" href="#results-and-interpretation-6"><i class="fas fa-link"></i></a>
</h3>
<p>The results are given in Figure <a href="tradeoffs.html#fig:fig-mortality-age">8.1</a>. We see senescence in natural mortality from age 2 onwards, as well as well as a slightly higher human-related mortality in the first year of life after birth. These patterns are similar to those obtained by <span class="citation">Koons et al. (<a href="references.html#ref-koons2014">2014</a>)</span>, check out their Figure 4.</p>
<div class="figure">
<span style="display:block;" id="fig:fig-mortality-age"></span>
<img src="banana-book_files/figure-html/fig-mortality-age-1.png" alt="Age‐specific mortality probabilities for human‐related (solid line) and natural (dashed line) causes in female roe deer at Trois‐Fontaines, France, from 1985 to 2013. Shaded polygons represent 95\% credible intervals." width="672"><p class="caption">
Figure 8.1: Age‐specific mortality probabilities for human‐related (solid line) and natural (dashed line) causes in female roe deer at Trois‐Fontaines, France, from 1985 to 2013. Shaded polygons represent 95% credible intervals.
</p>
</div>
</div>
</div>
<div id="quantifying-age-specific-breeding" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Quantifying age-specific breeding<a class="anchor" aria-label="anchor" href="#quantifying-age-specific-breeding"><i class="fas fa-link"></i></a>
</h2>
<div id="motivation-7" class="section level3" number="8.3.1">
<h3>
<span class="header-section-number">8.3.1</span> Motivation<a class="anchor" aria-label="anchor" href="#motivation-7"><i class="fas fa-link"></i></a>
</h3>
<p>Breeding is not a simple yes/no coin flip. Who breeds this year depends on what happened last year. In long-lived mammals, adult survival is high and fairly stable, but breeding probability can differ according to recent reproductive history and with how reliably we detect mothers and their offspring. If we blur these pieces and treat breeding status as perfectly known we risk biasing both survival and breeding estimates.</p>
<p><span class="citation">Couet et al. (<a href="references.html#ref-couet2019">2019</a>)</span> give a clear template with female bottlenose dolphins. They show that calf detectability differs by age and a female’s breeding probability depends on the outcome of her previous calf. Rather than assuming states are observed without error, they use a HMM to keep true breeding state hidden, model misclassification/detection explicitly, and tie breeding this year to last year’s outcome. That way, uncertainty about calf presence and age feeds correctly into demographic estimates.</p>
<p>Here, we follow that logic: we define hidden female states (nonbreeder vs. breeder with calf age classes), let detection vary by calf age, and make breeding probability state-dependent on the previous year’s result.</p>
</div>
<div id="model-and-nimble-implementation-7" class="section level3" number="8.3.2">
<h3>
<span class="header-section-number">8.3.2</span> Model and NIMBLE implementation<a class="anchor" aria-label="anchor" href="#model-and-nimble-implementation-7"><i class="fas fa-link"></i></a>
</h3>
<p>For our example, we’ll work with data from a population of bottlenose dolphins (<em>Tursiops truncatus</em>) inhabiting the French waters of the Normano-Breton Gulf in the English Channel. We have 106 encounter histories between 2004 and 2016, made of photographs taken from a boat between July and November, which corresponds to the birth peak and the best weather conditions for monitoring. These data were shared by Pauline Couet.</p>
<p>To build up our model, we first define the states and observations:</p>
<ul>
<li><p>States<br>
- NB for a non-breeding adult female<br>
- Byoy for a breeding adult female with a young of the year<br>
- Bc1 for a breeding adult female with a 1‐year‐old calf<br>
- Bc3 for a breeding adult female with a 3‐year‐old calf<br>
- Bc2 for a breeding adult female with a 2‐year‐old calf<br>
- D for a dead female</p></li>
<li><p>Observations<br>
- 1 for not seen<br>
- 2 for seen alone<br>
- 3 for seen with a young of the year<br>
- 4 for seen with a calf (1 to 3 years old)</p></li>
</ul>
<p>Now we turn to writing our model. We start with the vector of initial states:
<span class="math display">\[
\begin{matrix}
&amp; \\
\boldsymbol{\delta} =
\left ( \vphantom{ \begin{matrix} 1 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
\text{NB} &amp; \text{Byoy} &amp; \text{Bc1} &amp; \text{Bc2} &amp; \text{Bc3} &amp; \text{D} \\ \hdashline
\pi_1 &amp; \pi_2 &amp; \pi_3 &amp; \pi_4 &amp; \pi_5 &amp; 0
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 1 \end{matrix} } \right )
\end{matrix}
\]</span>
where <span class="math inline">\(\displaystyle \pi_5 = 1 - \sum_{j=1}^4\pi_j\)</span>.</p>
<!-- To write the transition matrix, we can make a diagram of the life cycle: -->
<!-- ```{r, engine = 'tikz', echo = FALSE} -->
<!-- \usetikzlibrary{arrows.meta, fit, positioning, automata} -->
<!-- \begin{tikzpicture}[ -->
<!--   >=Latex, node distance=24mm, -->
<!--   state/.style = {circle, draw, minimum size=8mm, font=\small, align=center} -->
<!-- ] -->
<!-- % Nodes -->
<!-- \node[state] (NB)   {NB}; -->
<!-- \node[state, right=of NB] (Byoy) {Byoy}; -->
<!-- \node[state, right=of Byoy] (Bc1)  {Bc1}; -->
<!-- \node[state, right=of Bc1] (Bc2)  {Bc2}; -->
<!-- \node[state, right=of Bc2] (Bc3)  {Bc3}; -->
<!-- \node[state, below=12mm of Bc2] (D) {D}; -->
<!-- % Adult survival (loops) -->
<!-- \draw[->] (NB)   edge[loop above] node[above] {$\phi_A$} (); -->
<!-- \draw[->] (Byoy) edge[loop above] node[above] {$\phi_A$} (); -->
<!-- \draw[->] (Bc1)  edge[loop above] node[above] {$\phi_A$} (); -->
<!-- \draw[->] (Bc2)  edge[loop above] node[above] {$\phi_A$} (); -->
<!-- \draw[->] (Bc3)  edge[loop above] node[above] {$\phi_A$} (); -->
<!-- % Death (to D) with labels under the arrows, slightly bent & shortened -->
<!-- \draw[->, shorten >=1.5pt, shorten <=2pt] -->
<!--   (NB)   to[out=-80, in=180] node[pos=0.55, sloped, below] {$1-\phi_A$} (D); -->
<!-- \draw[->, shorten >=1.5pt, shorten <=2pt] -->
<!--   (Byoy) to[out=-70, in=160] node[pos=0.55, sloped, below] {$1-\phi_A$} (D); -->
<!-- % --- tweaked placements --- -->
<!-- \draw[->, shorten >=1.5pt, shorten <=2pt] -->
<!--   (Bc1)  to[out=-55, in=145] node[pos=0.35, sloped, below] {$1-\phi_A$} (D); % label earlier to avoid crossing -->
<!-- \draw[->, shorten >=1.5pt, shorten <=4pt] -->
<!--   (Bc2) to[out=-30, in=110] -->
<!--   node[pos=0.30, sloped, below] {$1-\phi_A$} (D); % -------------------------------- -->
<!-- \draw[->, shorten >=1.5pt, shorten <=2pt] -->
<!--   (Bc3)  to[out=-60, in=60 ] node[pos=0.55, sloped, below] {$1-\phi_A$} (D); -->
<!-- % D absorbing -->
<!-- \draw[->] (D) edge[loop below] node[below] {$1$} (); -->
<!-- % Breeding switch -->
<!-- \draw[->] (NB) -- node[pos=0.5, above] {$\beta_1$} (Byoy); -->
<!-- % YOY survival -->
<!-- \draw[->] (Byoy) -- node[pos=0.5, above] {$\phi_{Y1}$} (Bc1); -->
<!-- % Aging with labels below the arrows -->
<!-- \draw[->] (Bc1) -- node[pos=0.5, below] {$1$} (Bc2); -->
<!-- \draw[->] (Bc2) -- node[pos=0.5, below] {$1$} (Bc3); -->
<!-- % Emancipation Bc3 -> NB (arc above to avoid crossing) -->
<!-- \draw[->] (Bc3) to[out=120, in=60, looseness=1.0] -->
<!--   node[pos=0.5, above] {$1$} (NB); -->
<!-- \end{tikzpicture} -->
<!-- ``` -->
<p>We proceed with the transition matrix given by <span class="citation">Couet et al. (<a href="references.html#ref-couet2019">2019</a>)</span>:
<span class="math display">\[
\begin{matrix}
&amp; \\
\mathbf{\Gamma} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
z_t=NB &amp; z_t = Byoy &amp; z_t = Bc1 &amp; z_t = Bc2 &amp; z_t = Bc3 &amp; z_t = D \\ \hdashline
\phi_A (1 - \beta_1) &amp; \phi_A \beta_1 &amp; 0 &amp; 0 &amp; 0 &amp; 1 - \phi_A \\
0 &amp; 0 &amp; \phi_A \phi_Y &amp; \phi_A (1-\phi_Y) &amp; 0 &amp; 1-\phi_A \\
\phi_A (1 - \beta_1) &amp; \phi_A \beta_1 &amp; 0 &amp; 0 &amp; 0 &amp; 1-\phi_A \\
\phi_A (1 - \beta_2) &amp; \phi_A \beta_2 &amp; 0 &amp; 0 &amp; 0 &amp; 1-\phi_A \\
\phi_A (1 - \beta_2) &amp; \phi_A \beta_2 &amp; 0 &amp; 0 &amp; 0 &amp; 1-\phi_A \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
z_{t-1} = NB \\
z_{t-1} = Byoy \\
z_{t-1} = Bc1 \\
z_{t-1} = Bc2 \\
z_{t-1} = Bc3 \\
z_{t-1} = D
\end{matrix}
\end{matrix}
\]</span></p>
<p>Rather than attempting to explain the full complexity of this matrix at once, I will follow the authors’ suggestion and break it down into four steps, each corresponding to a biological event in the life cycle of female bottlenose dolphins: (1) female survival <span class="math inline">\(\mathbf{\Phi_A}\)</span>, (2) young survival <span class="math inline">\(\mathbf{\Phi_Y}\)</span>, (3) young aging <span class="math inline">\(\mathbf{AGING}\)</span>, and (4) breeding <span class="math inline">\(\mathbf{BREED}\)</span>, each step being conditional on the previous ones. To do so, we introduce some intermediate states:</p>
<ul>
<li>Intermediate states<br>
- Byoy‐D for a breeding adult female that had lost her young of the year<br>
- Bc1‐D for a breeding adult female that had lost her 1‐year‐old calf<br>
- Bc2‐D for a breeding adult female that had lost her 2‐year‐old calf<br>
- Bc3‐leave Breeding adult female that raised her calf to the age of 3</li>
</ul>
<p>The four corresponding matrices are given below, starting with the female survival matrix:
<span class="math display">\[
\begin{matrix}
&amp; \\
\mathbf{\Phi_A} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
\text{NB} &amp; \text{Byoy} &amp; \text{Bc1} &amp; \text{Bc2} &amp; \text{Bc3} &amp; \text{D} \\ \hdashline
\phi_A &amp; 0      &amp; 0      &amp; 0      &amp; 0      &amp; 1 - \phi_A \\
0      &amp; \phi_A &amp; 0      &amp; 0      &amp; 0      &amp; 1 - \phi_A \\
0      &amp; 0      &amp; \phi_A &amp; 0      &amp; 0      &amp; 1 - \phi_A \\
0      &amp; 0      &amp; 0      &amp; \phi_A &amp; 0      &amp; 1 - \phi_A \\
0      &amp; 0      &amp; 0      &amp; 0      &amp; \phi_A &amp; 1 - \phi_A \\
0      &amp; 0      &amp; 0      &amp; 0      &amp; 0      &amp; 1
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
\text{NB} \\
\text{Byoy} \\
\text{Bc1} \\
\text{Bc2} \\
\text{Bc3} \\
\text{D}
\end{matrix}
\end{matrix}
\]</span></p>
<p>An adult female survives from <span class="math inline">\(t\)</span> to <span class="math inline">\(t+1\)</span> with probability <span class="math inline">\(\phi_A\)</span> or dies with <span class="math inline">\(1−\phi_A\)</span>. We go on with the young survival matrix:
<span class="math display">\[
\begin{matrix}
&amp; \\
\mathbf{\Phi_Y} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
\text{NB} &amp; \text{Byoy} &amp; \text{Byoy-D} &amp; \text{Bc1} &amp; \text{Bc1-D} &amp; \text{Bc2} &amp; \text{Bc2-D} &amp; \text{Bc3-leave} &amp; \text{D} \\ \hdashline
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; \phi_{Y} &amp; 1 - \phi_{Y} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; \phi_{Y} &amp; 1 - \phi_{Y} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \phi_{Y} &amp; 1 - \phi_{Y} &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
\text{NB} \\
\text{Byoy} \\
\text{Bc1} \\
\text{Bc2} \\
\text{Bc3} \\
\text{D}
\end{matrix}
\end{matrix}
\]</span></p>
<p>Offspring survive with probability <span class="math inline">\(\phi_Y\)</span> or die with <span class="math inline">\(1-\phi_Y\)</span>. If the calf survives, the female remains in the same breeding state. If it dies, she moves to an intermediate ‘dead-offspring’ state (BYOY-D, Bc1-D, or Bc2-D) so that later steps can condition on that loss. For 3-year-old calves, mortality cannot be distinguished from emancipation (leaving the mother), so we add an intermediate Bc3-leave state and fix survival to 1 there (this parameter is otherwise unidentifiable). As in the paper, I distinguish young‐of‐the‐year and 1‐year‐old calf survival from 2‐year‐old calf survival. We go on with the young aging matrix:
<span class="math display">\[
\begin{matrix}
&amp; \\
\mathbf{AGING} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
\text{NB} &amp; \text{Byoy} &amp; \text{Byoy-D} &amp; \text{Bc1} &amp; \text{Bc1-D} &amp; \text{Bc2} &amp; \text{Bc2-D} &amp; \text{Bc3-leave} &amp; \text{D} \\ \hdashline
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
\text{NB} \\
\text{Byoy} \\
\text{Byoy-D} \\
\text{Bc1} \\
\text{Bc1-D} \\
\text{Bc2} \\
\text{Bc2-D} \\
\text{Bc3-leave} \\
\text{D}
\end{matrix}
\end{matrix}
\]</span>
The progression of calf age classes between <span class="math inline">\(t\)</span> and <span class="math inline">\(t+1\)</span> is deterministic, all relevant age-advancing transitions are set to 1, and there are no parameters estimated in this matrix. Last, here is the breeding matrix:
<span class="math display">\[
\begin{matrix}
&amp; \\
\mathbf{BREED} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
\text{NB} &amp; \text{Byoy} &amp; \text{Bc1} &amp; \text{Bc2} &amp; \text{Bc3} &amp; \text{D} \\ \hdashline
1 - \beta_1 &amp; \beta_1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
1 - \beta_1 &amp; \beta_1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
1 - \beta_1 &amp; \beta_1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
1 - \beta_2 &amp; \beta_2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
1 - \beta_2 &amp; \beta_2 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
\text{NB} \\
\text{Byoy} \\
\text{Bc1} \\
\text{Bc2} \\
\text{Byoy-D} \\
\text{Bc1-D} \\
\text{Bc2-D} \\
\text{Bc3-leave} \\
\text{D}
\end{matrix}
\end{matrix}
\]</span></p>
<p>Breeding at <span class="math inline">\(t+1\)</span> occurs with probability <span class="math inline">\(\beta\)</span> (otherwise <span class="math inline">\(1−\beta\)</span>). Breeding can depend on the female’s state, namely non-breeding females and females that had just lost their young of the year or 1‐year‐old calf (<span class="math inline">\(\beta_1\)</span>) vs. females that had lost their 2‐year‐old calf or raised it until the age of 3 (<span class="math inline">\(\beta_2\)</span>).</p>
<p>Overall, the transition matrix is the product of all four matrices. In NIMBLE, we could code directly the full matrix, but I take this opportunity to illustrate how to code the splitting in several ecological processes:</p>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transition matrix</span></span>
<span></span>
<span><span class="co"># PHIA is 6x6</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">PHIA</span><span class="op">[</span><span class="va">i</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">adultsurvival</span></span>
<span>  <span class="va">PHIA</span><span class="op">[</span><span class="va">i</span>, <span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">adultsurvival</span></span>
<span><span class="op">}</span></span>
<span><span class="va">PHIA</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># PHIY is 6x9</span></span>
<span><span class="co"># Row 1: NB stays NB</span></span>
<span><span class="va">PHIY</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Row 2: Byoy</span></span>
<span><span class="va">PHIY</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">youngsurvival</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="co"># YOY survives → becomes Bc1</span></span>
<span><span class="va">PHIY</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">youngsurvival</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    <span class="co"># YOY dies     → becomes Byoy-D</span></span>
<span><span class="co"># Row 3: Bc1</span></span>
<span><span class="va">PHIY</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">youngsurvival</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="co"># 1-year-old survives → Bc2</span></span>
<span><span class="va">PHIY</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">youngsurvival</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    <span class="co"># dies → Bc1-D</span></span>
<span><span class="co"># Row 4: Bc2</span></span>
<span><span class="va">PHIY</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">youngsurvival</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>        <span class="co"># 2-year-old survives → Bc3-L (emancipation)</span></span>
<span><span class="va">PHIY</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">youngsurvival</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>    <span class="co"># dies → Bc2-D</span></span>
<span><span class="co"># Row 5: Bc3 always emancipates</span></span>
<span><span class="va">PHIY</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Row 6: dead female stays dead</span></span>
<span><span class="va">PHIY</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># AGING is 9x9</span></span>
<span><span class="va">AGING</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># NB → NB</span></span>
<span><span class="va">AGING</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># Byoy → Bc1</span></span>
<span><span class="va">AGING</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># Byoy-D → Byoy-D</span></span>
<span><span class="va">AGING</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># Bc1 → Bc2</span></span>
<span><span class="va">AGING</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># Bc1-D → Bc1-D</span></span>
<span><span class="va">AGING</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># Bc2 → Bc3</span></span>
<span><span class="va">AGING</span><span class="op">[</span><span class="fl">7</span>, <span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># Bc2-D → Bc2-D</span></span>
<span><span class="va">AGING</span><span class="op">[</span><span class="fl">8</span>, <span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># Bc3-L → Bc3-L</span></span>
<span><span class="va">AGING</span><span class="op">[</span><span class="fl">9</span>, <span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co"># D → D</span></span>
<span></span>
<span><span class="co"># BREED is 9x6</span></span>
<span><span class="co"># Row 1: NB → Byoy or NB</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Row 2: Bc1 → Bc1</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Row 3: Bc2 → Bc2</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Row 4: Bc3 → Bc3</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Row 5: Byoy-D → Byoy or NB</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Row 6: Bc1-D → Byoy or NB</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co"># Row 7: Bc2-D → Byoy or NB</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">7</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">7</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co"># Row 8: Bc3-L → Byoy or NB</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">8</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">8</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co"># Row 9: D → D</span></span>
<span><span class="va">BREED</span><span class="op">[</span><span class="fl">9</span>, <span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">gamma</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">PHIA</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">PHIY</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">AGING</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">BREED</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span></code></pre></div>
<p>Last step is the observation matrix that we can also split in two steps, given these intermediate observations:</p>
<ul>
<li>ND: for not detected<br>
</li>
<li>DNB: for a non-breeding female detected at time <span class="math inline">\(t\)</span><br>
</li>
<li>DByoy: for a breeding female with a young of the year detected at time <span class="math inline">\(t\)</span><br>
</li>
<li>DBc: for a breeding female with a 1-year-old calf detected at time <span class="math inline">\(t\)</span><br>
</li>
<li>DBc2: for a breeding female with a 2-year-old calf detected at time <span class="math inline">\(t\)</span><br>
</li>
<li>DBc3: for a breeding female with a 3-year-old calf detected at time <span class="math inline">\(t\)</span>
</li>
</ul>
<p>First, the detection step:
<span class="math display">\[
\begin{matrix}
&amp; \\
\mathbf{DETECTION} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
\text{ND} &amp; \text{DNB} &amp; \text{DByoy} &amp; \text{DBc} &amp; \text{DBc2} &amp; \text{DBc3} \\ \hdashline
1 - p_1 &amp; p_1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
1 - p_2 &amp; 0 &amp; p_2 &amp; 0 &amp; 0 &amp; 0 \\
1 - p_2 &amp; 0 &amp; 0 &amp; p_2 &amp; 0 &amp; 0 \\
1 - p_1 &amp; 0 &amp; 0 &amp; 0 &amp; p_1 &amp; 0 \\
1 - p_1 &amp; 0 &amp; 0 &amp; 0 &amp; p_1 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
\text{NB} \\
\text{Byoy} \\
\text{Bc1} \\
\text{Bc2} \\
\text{Bc3} \\
\text{D}
\end{matrix}
\end{matrix}
\]</span></p>
<p>which contains the probability <span class="math inline">\(p\)</span> of detecting the female given her latent state at <span class="math inline">\(t\)</span>: <span class="math inline">\(p_2\)</span> is for females with a young of the year or a 1‐year‐old calf and <span class="math inline">\(p_1\)</span> for non-breeding females or those with an older calf. Then the observation matrix:
<span class="math display">\[
\begin{matrix}
&amp; \\
\mathbf{OBS} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
1 &amp; 2 &amp; 3 &amp; 4 \\ \hdashline
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 1 - q_1 &amp; q_1 &amp; 0 \\
0 &amp; 1 - q_2 &amp; 0 &amp; q_2 \\
0 &amp; 1 - q_2 &amp; 0 &amp; q_2 \\
0 &amp; 1 - q_2 &amp; 0 &amp; q_2
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \\ 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
\text{ND} \\
\text{DNB} \\
\text{DByoy} \\
\text{DBc} \\
\text{DBc2} \\
\text{DBc3}
\end{matrix}
\end{matrix}
\]</span></p>
<p>where, conditional on being in a breeding state, there is a probability <span class="math inline">\(q\)</span> that a calf is seen vs. not seen. Calf age is not identifiable from photographs, so observations are seen or not seen, but <span class="math inline">\(q\)</span> may still vary by calf age (here young of the year vs. older). This is coded in NIMBLE as follows:</p>
<div class="sourceCode" id="cb360"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Observation matrix</span></span>
<span></span>
<span><span class="co"># Detection probabilities</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>     <span class="co"># NB not detected</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>         <span class="co"># NB detected</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>        <span class="co"># Byoy detected</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>         <span class="co"># Bc1 detected</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>         <span class="co"># Bc2 detected</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>         <span class="co"># Bc3 detected</span></span>
<span><span class="va">DETECTION</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>           <span class="co"># Dead never detected</span></span>
<span></span>
<span><span class="co"># OBS is 6x4</span></span>
<span><span class="co"># Not detected → not sighted</span></span>
<span><span class="va">OBS</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Detected NB → alone</span></span>
<span><span class="va">OBS</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># Detected Byoy → YOY visible or not</span></span>
<span><span class="va">OBS</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">q</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>    <span class="co"># alone</span></span>
<span><span class="va">OBS</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">q</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>        <span class="co"># with YOY</span></span>
<span><span class="co"># Detected Bc1 → calf visible or not</span></span>
<span><span class="va">OBS</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">OBS</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co"># Detected Bc2</span></span>
<span><span class="va">OBS</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">OBS</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co"># Detected Bc3</span></span>
<span><span class="va">OBS</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">OBS</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">q</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="va">omega</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">DETECTION</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">OBS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></code></pre></div>
</div>
<div id="results-and-interpretation-7" class="section level3" number="8.3.3">
<h3>
<span class="header-section-number">8.3.3</span> Results and interpretation<a class="anchor" aria-label="anchor" href="#results-and-interpretation-7"><i class="fas fa-link"></i></a>
</h3>
<p>The raw results are:</p>
<pre><code>##                  mean   sd 2.5%  50% 97.5% Rhat n.eff
## adultsurvival    0.96 0.01 0.94 0.96  0.98 1.00  2069
## beta[1]          0.35 0.04 0.28 0.35  0.45 1.03   656
## beta[2]          0.57 0.10 0.39 0.57  0.78 1.00  1009
## p[1]             0.63 0.03 0.58 0.63  0.69 1.00  1764
## p[2]             0.79 0.03 0.72 0.79  0.86 1.00  1123
## pi[1]            0.49 0.06 0.37 0.49  0.60 1.01  2743
## pi[2]            0.26 0.05 0.17 0.26  0.37 1.00  3412
## pi[3]            0.08 0.03 0.03 0.08  0.16 1.00  2225
## pi[4]            0.14 0.04 0.07 0.14  0.23 1.00  1931
## pi[5]            0.03 0.03 0.00 0.02  0.10 1.02  1315
## q[1]             0.59 0.05 0.49 0.59  0.69 1.01  1091
## q[2]             0.80 0.05 0.70 0.80  0.89 1.01   818
## youngsurvival[1] 0.63 0.05 0.55 0.63  0.73 1.00   808
## youngsurvival[2] 0.69 0.08 0.53 0.69  0.83 1.00  1702</code></pre>
<p>which we can re-arrange as in Table <a href="tradeoffs.html#tab:dolphin">8.1</a> to compare them to the estimates obtained by <span class="citation">Couet et al. (<a href="references.html#ref-couet2019">2019</a>)</span>:</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:dolphin">Table 8.1: </span>Age-specific estimates of breeding probabilities. Comparison of our NIMBLE estimates with Couet et al. (2019). ‘NR’ denotes quantities not reported in the paper. ‘NB’ is for non-breeding and ‘yoy’ for young-of-the-year. Adult female detection on the paper side is a rough time-average read by eye from the authors’ Figure 3 (2005–2016).</caption>
<colgroup>
<col width="50%">
<col width="24%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th align="left">Parameter</th>
<th align="center">NIMBLE</th>
<th align="center">Couet</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Adult female survival</td>
<td align="center">0.96 (0.94–0.98)</td>
<td align="center">0.97 (0.96-0.98)</td>
</tr>
<tr class="even">
<td align="left">Calf observation, yoy</td>
<td align="center">0.59 (0.49–0.69)</td>
<td align="center">0.58 (0.46-0.68)</td>
</tr>
<tr class="odd">
<td align="left">Calf observation, 1-3y</td>
<td align="center">0.80 (0.70–0.89)</td>
<td align="center">0.79 (0.59-0.90)</td>
</tr>
<tr class="even">
<td align="left">Calf survival (yoy)</td>
<td align="center">0.63 (0.55–0.73)</td>
<td align="center">0.66 (0.50-0.78)</td>
</tr>
<tr class="odd">
<td align="left">Calf survival (1y)</td>
<td align="center">0.69 (0.53–0.83)</td>
<td align="center">0.45 (0.29-0.61)</td>
</tr>
<tr class="even">
<td align="left">Female detection: NB or calf 2-3y</td>
<td align="center">0.63 (0.58–0.69)</td>
<td align="center">≈0.47</td>
</tr>
<tr class="odd">
<td align="left">Female detection: yoy or 1-year calf</td>
<td align="center">0.79 (0.72–0.86)</td>
<td align="center">≈0.61</td>
</tr>
<tr class="even">
<td align="left">Initial state NB</td>
<td align="center">0.49 (0.37–0.60)</td>
<td align="center">NR</td>
</tr>
<tr class="odd">
<td align="left">Initial state Byoy</td>
<td align="center">0.26 (0.17–0.37)</td>
<td align="center">NR</td>
</tr>
<tr class="even">
<td align="left">Initial state Bc1</td>
<td align="center">0.08 (0.03–0.16)</td>
<td align="center">NR</td>
</tr>
<tr class="odd">
<td align="left">Initial state Bc2</td>
<td align="center">0.14 (0.07–0.23)</td>
<td align="center">NR</td>
</tr>
<tr class="even">
<td align="left">Initial state Bc3</td>
<td align="center">0.03 (0.00–0.10)</td>
<td align="center">NR</td>
</tr>
</tbody>
</table></div>
<p>Our NIMBLE estimates track the published values closely. Calf survival shows some discrepancies, but credible and confidence intervals overlap, so I would not worry too much. Note also that our model differs slightly: we held adult female detection constant in time, whereas the paper models it as time‐dependent.</p>
<p>Offspring are often missed even when a female is breeding, especially young of the year, which are harder to see than older calves. Offspring detection is well below 1. Adult detection also depends on the female’s state: females with a young of the year or 1-year calf are more detectable than non-breeders or those with older calves.</p>
<p>Adult female survival is high. Calf survival ranks young-of-the-year ≥ 1-year. Breeding probability depends on recent history: it’s lower after non-breeding or losing a young-of-the-year/1-year calf, and higher after losing a 2-year calf or successfully raising a calf to age 3.</p>
</div>
</div>
<div id="estimating-stopover-duration" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Estimating stopover duration<a class="anchor" aria-label="anchor" href="#estimating-stopover-duration"><i class="fas fa-link"></i></a>
</h2>
<div id="motivation-8" class="section level3" number="8.4.1">
<h3>
<span class="header-section-number">8.4.1</span> Motivation<a class="anchor" aria-label="anchor" href="#motivation-8"><i class="fas fa-link"></i></a>
</h3>
<p>Stopover is not just a logistical pause; it’s a stage-specific timing trait in a migratory life cycle. Like age at first reproduction or length of a breeding attempt, the duration of stopover shapes exposure to predators, energy balance, and downstream reproductive timing. Two core questions in migration ecology are: (1) how long individuals stop over, and (2) whether groups differ in their stopover behaviour. Treating stopover as a life-history trait puts those questions center stage.</p>
<p>The catch is that arrivals and departures are hidden and detection is imperfect. If we only look at when individuals are seen, we bias both the entry curve and the distribution of stay lengths. As reviewed in <span class="citation">Guérin et al. (<a href="references.html#ref-guerin_advances_2017">2017</a>)</span>, a HMM fixes this by keeping states hidden and observations separate: for example, we may use three latent states: not yet arrived, arrived (present), departed; and let two transition probabilities drive dynamics: recruitment (from not yet arrived to arrived) and staying (from arrived to arrived). Detection operates only in state arrived. This so-called time-effect parameterization assumes staying depends on calendar date, not time since arrival, which is often the right first step.</p>
<p>With this setup we can estimate daily entry and staying probabilities, derive expected stopover duration for an arrival date, and test for group differences in behaviour.</p>
</div>
<div id="model-and-nimble-implementation-8" class="section level3" number="8.4.2">
<h3>
<span class="header-section-number">8.4.2</span> Model and NIMBLE implementation<a class="anchor" aria-label="anchor" href="#model-and-nimble-implementation-8"><i class="fas fa-link"></i></a>
</h3>
<p>We illustrate the model with marbled newts (<em>Triturus marmoratus</em>) monitored in 2013 at a permanent pond near Vigneux-de-Bretagne (Loire-Atlantique, western France). Intensive capture-recapture yielded 713 PIT-tagged newts (412 males, 301 females). Captures within the same week were pooled to create 12 equally spaced occasions (11 weekly samples plus a leading ‘empty’ occasion), so all individuals start in the ‘not yet arrived’ state. These data were shared by Sandra Guérin.</p>
<p>To build up our model, we first define the states and observations:</p>
<ul>
<li><p>States<br>
- NYA for not yet arrived in the pond<br>
- ARR for arrived in the pond<br>
- DEP departed from the pond</p></li>
<li><p>Observations<br>
- 1 for not captured<br>
- 2 for captured</p></li>
</ul>
<p>Now we turn to writing our model. We start with the vector of initial states. At the start of the study, everyone is in <span class="math inline">\(NYA\)</span>, so the initial state vector is:
<span class="math display">\[
\begin{matrix}
&amp; \\
\boldsymbol{\delta} =
\left ( \vphantom{ \begin{matrix} 1 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
\text{NYA} &amp; \text{ARR} &amp; \text{DEP} \\ \hdashline
1 &amp; 0 &amp; 0
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 1 \end{matrix} } \right )
\end{matrix}
\]</span></p>
<p>We proceed with the transition matrix, which is governed by two processes: recruitment <span class="math inline">\(r\)</span> is the probability that an individual in <span class="math inline">\(NYA\)</span> enters the pond and staying <span class="math inline">\(s\)</span> is the probability that an individual in <span class="math inline">\(ARR\)</span> remains in the pond. State <span class="math inline">\(DEP\)</span> is absorbing. We have:
<span class="math display">\[\begin{matrix}
&amp; \\
\mathbf{\Gamma} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
z_t=NYA &amp; z_t=ARR &amp; z_t=DEP \\ \hdashline
1 - r &amp; r &amp; 0 \\
0 &amp; s &amp; 1 - s \\
0 &amp; 0 &amp; 1
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
z_{t-1}=NYA \\ z_{t-1}=ARR \\ z_{t-1}=DEP
\end{matrix}
\end{matrix}\]</span></p>
<p>We make both parameters <span class="math inline">\(r\)</span> and <span class="math inline">\(s\)</span> sex and time-dependent, which we code in NIMBLE:</p>
<div class="sourceCode" id="cb362"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">K</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/gtools/man/logit.html">logit</a></span><span class="op">(</span><span class="va">r</span><span class="op">[</span><span class="fl">1</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">beta</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">j</span><span class="op">-</span><span class="fl">4.5</span><span class="op">)</span><span class="op">/</span><span class="fl">2.45</span> <span class="co"># prior probability of arriving in the pond / 1 = female</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/gtools/man/logit.html">logit</a></span><span class="op">(</span><span class="va">r</span><span class="op">[</span><span class="fl">2</span>,<span class="va">j</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">beta</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">j</span><span class="op">-</span><span class="fl">4.5</span><span class="op">)</span><span class="op">/</span><span class="fl">2.45</span> <span class="co"># prior probability of arriving in the pond / 2 = male</span></span>
<span>  <span class="va">s</span><span class="op">[</span><span class="fl">1</span>,<span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">dunif</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># prior retention probability (staying) / 1 = female</span></span>
<span>  <span class="va">s</span><span class="op">[</span><span class="fl">2</span>,<span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">dunif</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># prior retention probability (staying) / 2 = male</span></span>
<span><span class="op">}</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">K</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">r</span><span class="op">[</span><span class="va">sex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">j</span><span class="op">]</span> </span>
<span>    <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">r</span><span class="op">[</span><span class="va">sex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">j</span><span class="op">]</span> </span>
<span>    <span class="va">gamma</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span> </span>
<span>    <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">[</span><span class="va">sex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">j</span><span class="op">]</span></span>
<span>    <span class="va">gamma</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">s</span><span class="op">[</span><span class="va">sex</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="va">j</span><span class="op">]</span></span>
<span>    <span class="va">gamma</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span> </span>
<span>    <span class="va">gamma</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span> </span>
<span>    <span class="va">gamma</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Graphically, this corresponds to:</p>
<div class="inline-figure"><img src="banana-book_files/figure-html/diagram-stopover-1.png" width="672"></div>
<p>Last step is the observation matrix:
<span class="math display">\[\begin{matrix}
&amp; \\
\mathbf{\Omega} =
\left ( \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \end{matrix} } \right .
\end{matrix}
\hspace{-1.2em}
\begin{matrix}
y_t=1 &amp; y_t=2 \\ \hdashline
1 &amp; 0 \\
1-p &amp; p \\
1 &amp; 0
\end{matrix}
\hspace{-0.2em}
\begin{matrix}
&amp; \\
\left . \vphantom{ \begin{matrix} 12 \\ 12 \\ 12 \end{matrix} } \right )
\begin{matrix}
z_{t}=NYA \\ z_{t}=ARR \\ z_{t}=DEP
\end{matrix}
\end{matrix}\]</span></p>
<p>where only individuals in state <span class="math inline">\(ARR\)</span> are observable with probability <span class="math inline">\(p\)</span>.</p>
<p>The likelihood and priors are handled as usual.</p>
<p>Using MCMC draws from the posterior distribution of the staying probability <span class="math inline">\(s\)</span>, we can calculate the expected stopover duration <span class="math inline">\(\mathbb{E}[D]\)</span> which is the number of occasions present after arrival. With constant <span class="math inline">\(s\)</span>, this is given by:
<span class="math display">\[
\mathbb{E}[D] \;=\; \frac{1}{\,1 - s\,}.
\]</span></p>
<p>Why is that? Because the length of stay (counting the arrival occasion) is geometric. After arriving, you are present this week with probability 1 (that’s 1 week). You are still present next week with probability <span class="math inline">\(s\)</span>. You are still present the week after with probability <span class="math inline">\(s^2\)</span>. And so on. So the expected number of occasions present is the sum of those probabilities:</p>
<p><span class="math display">\[
\mathbb{E}[D] \;=\; 1+s+s^2+\cdots \;=\; \frac{1}{\,1 - s\,}.
\]</span></p>
<p>When <span class="math inline">\(s\)</span> varies with date, the ‘length of stay’ after arrival is no longer geometric with a single parameter, it’s a non-homogeneous geometric process with week-specific stay probabilities <span class="math inline">\(s_t\)</span>. If an individual arrives on date <span class="math inline">\(\tau\)</span>, the chance it is still present <span class="math inline">\(k\)</span> occasions later is the product of the stay probabilities along that run:</p>
<p><span class="math display">\[
Pr(D &gt; k \mid \text{arrive at } \tau) \;=\; \prod_{j=0}^{k-1} s_{\tau + j}.
\]</span></p>
<p>Therefore, the expected number of occasions present (counting the arrival occasion) is the sum of those tail probabilities:
<span class="math display">\[
\mathbb{E}[D \mid \text{arrive at } \tau]
\;=\;
\sum_{k=0}^{\infty} \prod_{j=0}^{k-1} s_{\tau + j}.
\]</span></p>
<p>with the empty product for <span class="math inline">\(k=0\)</span> equal to 1, or in other words the sum of the probabilities of ‘surviving’ each additional week in <span class="math inline">\(ARR\)</span> under the calendar-date effects.</p>
</div>
<div id="results-and-interpretation-8" class="section level3" number="8.4.3">
<h3>
<span class="header-section-number">8.4.3</span> Results and interpretation<a class="anchor" aria-label="anchor" href="#results-and-interpretation-8"><i class="fas fa-link"></i></a>
</h3>
<p>Our NIMBLE estimates match pretty closely those obtained by <span class="citation">Guérin et al. (<a href="references.html#ref-guerin_advances_2017">2017</a>)</span>, check out their Figure 2.</p>
<p>Early in the season, females arrive first: during the first three capture occasions their arrival probability exceeds that of males (Figure <a href="tradeoffs.html#fig:fig-arrival-prob">8.2</a>). By occasion 7, essentially all individuals have entered the pond.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-arrival-prob"></span>
<img src="banana-book_files/figure-html/fig-arrival-prob-1.png" alt="Arrival probability by sex and week. Means and 95\% credible intervals (shaded areas) are provided." width="85%"><p class="caption">
Figure 8.2: Arrival probability by sex and week. Means and 95% credible intervals (shaded areas) are provided.
</p>
</div>
<p>Females show longer stopovers than males for most of the season; near the end, the pattern reverses (Figure <a href="tradeoffs.html#fig:fig-stopover-duration">8.3</a>). Individuals arriving early in the breeding season stay longer than those arriving later.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-stopover-duration"></span>
<img src="banana-book_files/figure-html/fig-stopover-duration-1.png" alt="Stopover duration by sex and arrival week. Means and 95\% credible intervals (shaded areas) are provided." width="85%"><p class="caption">
Figure 8.3: Stopover duration by sex and arrival week. Means and 95% credible intervals (shaded areas) are provided.
</p>
</div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="lackoffit.html"><span class="header-section-number">7</span> Addressing model lack of fit</a></div>
<div class="next"><a href="conclusion.html">Conclusion</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tradeoffs"><span class="header-section-number">8</span> Quantifying life history traits</a></li>
<li><a class="nav-link" href="#introduction-10"><span class="header-section-number">8.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#assessing-age--and-cause-specific-mortality"><span class="header-section-number">8.2</span> Assessing age- and cause-specific mortality</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#motivation-6"><span class="header-section-number">8.2.1</span> Motivation</a></li>
<li><a class="nav-link" href="#model-and-nimble-implementation-6"><span class="header-section-number">8.2.2</span> Model and NIMBLE implementation</a></li>
<li><a class="nav-link" href="#results-and-interpretation-6"><span class="header-section-number">8.2.3</span> Results and interpretation</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#quantifying-age-specific-breeding"><span class="header-section-number">8.3</span> Quantifying age-specific breeding</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#motivation-7"><span class="header-section-number">8.3.1</span> Motivation</a></li>
<li><a class="nav-link" href="#model-and-nimble-implementation-7"><span class="header-section-number">8.3.2</span> Model and NIMBLE implementation</a></li>
<li><a class="nav-link" href="#results-and-interpretation-7"><span class="header-section-number">8.3.3</span> Results and interpretation</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#estimating-stopover-duration"><span class="header-section-number">8.4</span> Estimating stopover duration</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#motivation-8"><span class="header-section-number">8.4.1</span> Motivation</a></li>
<li><a class="nav-link" href="#model-and-nimble-implementation-8"><span class="header-section-number">8.4.2</span> Model and NIMBLE implementation</a></li>
<li><a class="nav-link" href="#results-and-interpretation-8"><span class="header-section-number">8.4.3</span> Results and interpretation</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/oliviergimenez/banana-book/blob/master/8-lifehistory.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/oliviergimenez/banana-book/edit/master/8-lifehistory.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Bayesian analysis of capture-recapture data with hidden Markov models</strong>: Theory and case studies in R and NIMBLE" was written by Olivier Gimenez. It was last built on 2025-09-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
